<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>mybatis一对多映射</title>
      <link href="/2019/08/29/mybatis%E4%B8%80%E5%AF%B9%E5%A4%9A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"/>
      <url>/2019/08/29/mybatis%E4%B8%80%E5%AF%B9%E5%A4%9A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ul><li>启动类加上MapperScan</li><li>映射文件路径配置要对应到生成的Mapper.xml文件<a id="more"></a><h2 id="application-yml配置文件"><a href="#application-yml配置文件" class="headerlink" title="application.yml配置文件"></a>application.yml配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    driver-class-name: com.microsoft.sqlserver.jdbc.SQLServerDriver</span><br><span class="line">    username: sa</span><br><span class="line">    password: longqi.123</span><br><span class="line">    url: jdbc:sqlserver://localhost:8888;database=shiro</span><br><span class="line">mybatis:</span><br><span class="line">  mapper-locations: classpath:mappers/*Mapper.xml</span><br><span class="line">  type-aliases-package: com.howard.shiro.shiro.mappers</span><br></pre></td></tr></table></figure></li></ul><h2 id="mybatis可以根据ResultMap映射一对多"><a href="#mybatis可以根据ResultMap映射一对多" class="headerlink" title="mybatis可以根据ResultMap映射一对多"></a>mybatis可以根据ResultMap映射一对多</h2><blockquote><p>自动生成实体类后,在实体类里添加关联表实体<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">public class UserInfoEntity &#123;</span><br><span class="line">    private Integer userId;</span><br><span class="line"></span><br><span class="line">    private String userName;</span><br><span class="line"></span><br><span class="line">    private String password;</span><br><span class="line"></span><br><span class="line">    private String salt;</span><br><span class="line"></span><br><span class="line">    private String email;</span><br><span class="line"></span><br><span class="line">    private Integer status;</span><br><span class="line"></span><br><span class="line">    private Date lastLoginTime;</span><br><span class="line"></span><br><span class="line">    private Date createTime;</span><br><span class="line"></span><br><span class="line">    private Date modifyTime;</span><br><span class="line"></span><br><span class="line">    private String activeCode;</span><br><span class="line"></span><br><span class="line">    private Integer deptId;</span><br><span class="line"></span><br><span class="line">    private List&lt;RoleEntity&gt; roles;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>在UserMapper.xml的ResultMap标签里配置collection标签<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">UserMapper.xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.howard.shiro.shiro.mapper.UserInfoEntityMapper&quot;&gt;</span><br><span class="line"></span><br><span class="line">  &lt;resultMap id=&quot;BaseResultMap&quot; type=&quot;com.howard.shiro.shiro.entity.UserInfoEntity&quot;&gt;</span><br><span class="line">    &lt;id column=&quot;user_id&quot; jdbcType=&quot;INTEGER&quot; property=&quot;userId&quot; /&gt;</span><br><span class="line">    &lt;result column=&quot;user_name&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;userName&quot; /&gt;</span><br><span class="line">    &lt;result column=&quot;password&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;password&quot; /&gt;</span><br><span class="line">    &lt;result column=&quot;salt&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;salt&quot; /&gt;</span><br><span class="line">    &lt;result column=&quot;email&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;email&quot; /&gt;</span><br><span class="line">    &lt;result column=&quot;status&quot; jdbcType=&quot;INTEGER&quot; property=&quot;status&quot; /&gt;</span><br><span class="line">    &lt;result column=&quot;last_login_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;lastLoginTime&quot; /&gt;</span><br><span class="line">    &lt;result column=&quot;create_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;createTime&quot; /&gt;</span><br><span class="line">    &lt;result column=&quot;modify_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;modifyTime&quot; /&gt;</span><br><span class="line">    &lt;result column=&quot;active_code&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;activeCode&quot; /&gt;</span><br><span class="line">    &lt;result column=&quot;dept_id&quot; jdbcType=&quot;INTEGER&quot; property=&quot;deptId&quot; /&gt;</span><br><span class="line">  &lt;/resultMap&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;resultMap id=&quot;BaseRoleResultMap&quot; type=&quot;com.howard.shiro.shiro.entity.RoleEntity&quot;&gt;</span><br><span class="line">    &lt;id column=&quot;role_id&quot; jdbcType=&quot;INTEGER&quot; property=&quot;roleId&quot; /&gt;</span><br><span class="line">    &lt;result column=&quot;role_name&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;roleName&quot; /&gt;</span><br><span class="line">    &lt;result column=&quot;remark&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;remark&quot; /&gt;</span><br><span class="line">    &lt;result column=&quot;create_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;createTime&quot; /&gt;</span><br><span class="line">    &lt;result column=&quot;modify_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;modifyTime&quot; /&gt;</span><br><span class="line">  &lt;/resultMap&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;resultMap id=&quot;UserRolePermResultMap&quot; type=&quot;com.howard.shiro.shiro.entity.UserInfoEntity&quot; extends=&quot;BaseResultMap&quot;&gt;</span><br><span class="line">    &lt;collection property=&quot;roles&quot; ofType=&quot;com.howard.shiro.shiro.entity.RoleEntity&quot;</span><br><span class="line">                select=&quot;selectAllRoleByUserId&quot; column=&quot;user_id&quot;/&gt;</span><br><span class="line">&lt;!--extend标识继承 select标签对应子查询语句,column标签对应传递的值 --&gt;</span><br><span class="line">  &lt;/resultMap&gt;</span><br><span class="line">  &lt;sql id=&quot;Base_Column_List&quot;&gt;</span><br><span class="line">    user_id, user_name, password, salt, email, status, last_login_time, create_time, modify_time,</span><br><span class="line">    active_code, dept_id</span><br><span class="line">  &lt;/sql&gt;</span><br><span class="line"></span><br><span class="line">  &lt;sql id=&quot;Base_Role_List&quot;&gt;</span><br><span class="line">    role.role_id, role.role_name, role.remark, role.create_time, role.modify_time</span><br><span class="line">  &lt;/sql&gt;</span><br><span class="line"></span><br><span class="line">  &lt;select id=&quot;selectAllRoleByUserId&quot; resultMap=&quot;BaseRoleResultMap&quot; parameterType=&quot;java.lang.Integer&quot;&gt;</span><br><span class="line">    select</span><br><span class="line">    &lt;include refid=&quot;Base_Role_List&quot;/&gt;</span><br><span class="line">    from</span><br><span class="line">    user_role</span><br><span class="line">    inner join role ON user_role.role_id  = role.role_id</span><br><span class="line">    where</span><br><span class="line">    user_role.user_id = #&#123;user_id&#125;</span><br><span class="line">  &lt;/select&gt;</span><br><span class="line">    &lt;select id=&quot;selectUserInfoRoleByUserName&quot; parameterType=&quot;java.lang.String&quot; resultMap=&quot;UserRolePermResultMap&quot;&gt;</span><br><span class="line">    select</span><br><span class="line">    &lt;include refid=&quot;Base_Column_List&quot;/&gt;</span><br><span class="line">    from</span><br><span class="line">    user_info</span><br><span class="line">    where</span><br><span class="line">    user_name=#&#123;userName&#125;</span><br><span class="line">  &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
          <category> SSM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MyBatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mybatis逆向生成工程</title>
      <link href="/2019/08/28/mybatis%E9%80%86%E5%90%91%E7%94%9F%E6%88%90/"/>
      <url>/2019/08/28/mybatis%E9%80%86%E5%90%91%E7%94%9F%E6%88%90/</url>
      
        <content type="html"><![CDATA[<h1 id="使用maven插件实现"><a href="#使用maven插件实现" class="headerlink" title="使用maven插件实现"></a>使用maven插件实现</h1><h2 id="pom文件引入依赖"><a href="#pom文件引入依赖" class="headerlink" title="pom文件引入依赖"></a>pom文件引入依赖</h2><a id="more"></a><h3 id="逆向生成依赖"><a href="#逆向生成依赖" class="headerlink" title="逆向生成依赖"></a>逆向生成依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-generator-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.3.7&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h3 id="逆向生成maven插件"><a href="#逆向生成maven插件" class="headerlink" title="逆向生成maven插件"></a>逆向生成maven插件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">             &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;</span><br><span class="line">             &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">             &lt;version&gt;1.3.7&lt;/version&gt;</span><br><span class="line">             &lt;configuration&gt;</span><br><span class="line">                 &lt;configurationFile&gt;</span><br><span class="line">$&#123;basedir&#125;/src/main/resources/generator/generatorConfig.xml</span><br><span class="line">&lt;/configurationFile&gt;</span><br><span class="line">                 &lt;overwrite&gt;true&lt;/overwrite&gt;</span><br><span class="line">                 &lt;verbose&gt;true&lt;/verbose&gt;</span><br><span class="line">             &lt;/configuration&gt;</span><br><span class="line">         &lt;/plugin&gt;</span><br></pre></td></tr></table></figure><blockquote><p>configurationFile逆向工程配置文件地址,地址可以按照自己的想法写</p></blockquote><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE generatorConfiguration</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;&gt;</span><br><span class="line">&lt;generatorConfiguration&gt;</span><br><span class="line">    &lt;!-- 数据库驱动:选择你的本地硬盘上面的数据库驱动包--&gt;</span><br><span class="line">    &lt;classPathEntry location=&quot;C:\Users\LongQi-Howard\Downloads\mssql-jdbc-6.4.0.jre8.jar&quot;/&gt;</span><br><span class="line">    &lt;context id=&quot;DB2Tables&quot; targetRuntime=&quot;MyBatis3&quot;&gt;</span><br><span class="line">        &lt;commentGenerator&gt;</span><br><span class="line">            &lt;property name=&quot;suppressDate&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">            &lt;!-- 是否去除自动生成的注释 true：是 ： false:否 --&gt;</span><br><span class="line">            &lt;property name=&quot;suppressAllComments&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;/commentGenerator&gt;</span><br><span class="line">        &lt;!--数据库链接URL，用户名、密码 --&gt;</span><br><span class="line">        &lt;jdbcConnection driverClass=&quot;com.microsoft.sqlserver.jdbc.SQLServerDriver&quot;</span><br><span class="line">                        connectionURL=&quot;jdbc:sqlserver://218.28.44.115:8888;database=shiro&quot; userId=&quot;sa&quot;</span><br><span class="line">                        password=&quot;longqi.123&quot;&gt;</span><br><span class="line">        &lt;/jdbcConnection&gt;</span><br><span class="line">        &lt;javaTypeResolver&gt;</span><br><span class="line">            &lt;property name=&quot;forceBigDecimals&quot; value=&quot;false&quot;/&gt;</span><br><span class="line">        &lt;/javaTypeResolver&gt;</span><br><span class="line">        &lt;!-- 生成实体类的包名和位置--&gt;</span><br><span class="line">        &lt;javaModelGenerator targetPackage=&quot;com.howard.shiro.shiro.entity&quot; targetProject=&quot;src/main/java&quot;&gt;</span><br><span class="line">            &lt;!-- enableSubPackages:是否让schema作为包的后缀 --&gt;</span><br><span class="line">            &lt;property name=&quot;enableSubPackages&quot; value=&quot;false&quot;/&gt;</span><br><span class="line">            &lt;!-- 从数据库返回的值被清理前后的空格 --&gt;</span><br><span class="line">            &lt;property name=&quot;trimStrings&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;/javaModelGenerator&gt;</span><br><span class="line">        &lt;!-- 生成Mapper.xml的包名和位置--&gt;</span><br><span class="line">        &lt;sqlMapGenerator targetPackage=&quot;mappers&quot; targetProject=&quot;./src/main/resources&quot;&gt;</span><br><span class="line">            &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;/sqlMapGenerator&gt;</span><br><span class="line">        &lt;!-- 生成mapper接口的位置--&gt;</span><br><span class="line">        &lt;javaClientGenerator type=&quot;XMLMAPPER&quot; targetPackage=&quot;com.howard.shiro.shiro.mapper&quot;</span><br><span class="line">                             targetProject=&quot;src/main/java&quot;&gt;</span><br><span class="line">            &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;/javaClientGenerator&gt;</span><br><span class="line">        &lt;!-- 要生成的表 tableName是数据库中的表名或视图名 domainObjectName是实体类名--&gt;</span><br><span class="line">&lt;!--        &lt;table tableName=&quot;user_info&quot; domainObjectName=&quot;UserInfoEntity&quot;--&gt;</span><br><span class="line">&lt;!--               enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot;--&gt;</span><br><span class="line">&lt;!--               enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot;--&gt;</span><br><span class="line">&lt;!--               selectByExampleQueryId=&quot;false&quot;&gt;--&gt;</span><br><span class="line">&lt;!--        &lt;/table&gt;--&gt;</span><br><span class="line">&lt;!--        &lt;table tableName=&quot;user_role&quot; domainObjectName=&quot;UserRoleEntity&quot;--&gt;</span><br><span class="line">&lt;!--               enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot;--&gt;</span><br><span class="line">&lt;!--               enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot;--&gt;</span><br><span class="line">&lt;!--               selectByExampleQueryId=&quot;false&quot;&gt;--&gt;</span><br><span class="line">&lt;!--        &lt;/table&gt;--&gt;</span><br><span class="line">&lt;!--        &lt;table tableName=&quot;role_operator&quot; domainObjectName=&quot;RoleOperatorEntity&quot;--&gt;</span><br><span class="line">&lt;!--               enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot;--&gt;</span><br><span class="line">&lt;!--               enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot;--&gt;</span><br><span class="line">&lt;!--               selectByExampleQueryId=&quot;false&quot;&gt;--&gt;</span><br><span class="line">&lt;!--        &lt;/table&gt;--&gt;</span><br><span class="line">&lt;!--        &lt;table tableName=&quot;role_menu&quot; domainObjectName=&quot;RoleMenuEntity&quot;--&gt;</span><br><span class="line">&lt;!--               enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot;--&gt;</span><br><span class="line">&lt;!--               enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot;--&gt;</span><br><span class="line">&lt;!--               selectByExampleQueryId=&quot;false&quot;&gt;--&gt;</span><br><span class="line">&lt;!--        &lt;/table&gt;--&gt;</span><br><span class="line">&lt;!--        &lt;table tableName=&quot;role&quot; domainObjectName=&quot;RoleEntity&quot;--&gt;</span><br><span class="line">&lt;!--               enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot;--&gt;</span><br><span class="line">&lt;!--               enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot;--&gt;</span><br><span class="line">&lt;!--               selectByExampleQueryId=&quot;false&quot;&gt;--&gt;</span><br><span class="line">&lt;!--        &lt;/table&gt;--&gt;</span><br><span class="line">&lt;!--        &lt;table tableName=&quot;operator&quot; domainObjectName=&quot;OperatorEntity&quot;--&gt;</span><br><span class="line">&lt;!--               enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot;--&gt;</span><br><span class="line">&lt;!--               enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot;--&gt;</span><br><span class="line">&lt;!--               selectByExampleQueryId=&quot;false&quot;&gt;--&gt;</span><br><span class="line">&lt;!--        &lt;/table&gt;--&gt;</span><br><span class="line">&lt;!--        &lt;table tableName=&quot;menu&quot; domainObjectName=&quot;MenuEntity&quot;--&gt;</span><br><span class="line">&lt;!--               enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot;--&gt;</span><br><span class="line">&lt;!--               enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot;--&gt;</span><br><span class="line">&lt;!--               selectByExampleQueryId=&quot;false&quot;&gt;--&gt;</span><br><span class="line">&lt;!--        &lt;/table&gt;--&gt;</span><br><span class="line">&lt;!--        &lt;table tableName=&quot;dept&quot; domainObjectName=&quot;DeptEntity&quot;--&gt;</span><br><span class="line">&lt;!--               enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot;--&gt;</span><br><span class="line">&lt;!--               enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot;--&gt;</span><br><span class="line">&lt;!--               selectByExampleQueryId=&quot;false&quot;&gt;--&gt;</span><br><span class="line">&lt;!--        &lt;/table&gt;--&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/context&gt;</span><br><span class="line">&lt;/generatorConfiguration&gt;</span><br></pre></td></tr></table></figure><blockquote><p>然后运行maven插件下的 mybatis-generator:generator <img src="mybatis逆向生成_files/1.jpg" alt></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
          <category> SSM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MyBatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shiro配置留档</title>
      <link href="/2019/08/28/SpringBoot+Shiro/"/>
      <url>/2019/08/28/SpringBoot+Shiro/</url>
      
        <content type="html"><![CDATA[<h1 id="Shiro配置"><a href="#Shiro配置" class="headerlink" title="Shiro配置"></a>Shiro配置</h1><h2 id="shiro核心配置类"><a href="#shiro核心配置类" class="headerlink" title="shiro核心配置类"></a>shiro核心配置类</h2><h3 id="MyShiroRealm"><a href="#MyShiroRealm" class="headerlink" title="MyShiroRealm"></a>MyShiroRealm</h3><blockquote><p>继承 AuthorizingRealm 重写doGetAuthorizationInfo(授权),doGetAuthenticationInfo(鉴权)方法<br><a id="more"></a></p><blockquote><p>MyShiroRealm<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * create by: liumeng</span></span><br><span class="line"><span class="comment"> * description: 授权</span></span><br><span class="line"><span class="comment"> * create time: 2019/8/29 14:21</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ： principalCollection</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> : org.apache.shiro.authz.AuthorizationInfo</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> </span>&#123;</span><br><span class="line">    UserInfoEntity user = (UserInfoEntity) principalCollection.getPrimaryPrincipal();</span><br><span class="line">    String userName = user.getUserName();</span><br><span class="line">    UserInfoEntity userInfoEntity = userService.getAllUserInfoByUserName(userName);</span><br><span class="line">    Set&lt;String&gt; roles = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">    Set&lt;String&gt; perms = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (RoleEntity roleEntity :</span><br><span class="line">            userInfoEntity.getRoles()) &#123;</span><br><span class="line">        roles.add(roleEntity.getRoleName());</span><br><span class="line">        <span class="keyword">for</span> (MenuEntity menu :</span><br><span class="line">                roleEntity.getMenus()) &#123;</span><br><span class="line">            perms.add(menu.getPerms());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (OperatorEntity operatorEntity :</span><br><span class="line">                roleEntity.getOperators()) &#123;</span><br><span class="line">            perms.add(operatorEntity.getPerms());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    SimpleAuthorizationInfo authorizationInfo = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">    authorizationInfo.setRoles(roles);</span><br><span class="line">    authorizationInfo.setStringPermissions(perms);</span><br><span class="line">    <span class="keyword">return</span> authorizationInfo;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * create by: liumeng</span></span><br><span class="line"><span class="comment"> * description: 鉴权</span></span><br><span class="line"><span class="comment"> * create time: 2019/8/29 15:11</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> ： authenticationToken</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> : org.apache.shiro.authc.AuthenticationInfo</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken authenticationToken)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">    String userName = (String) authenticationToken.getPrincipal();</span><br><span class="line">    UserInfoEntity userInfoEntity = userService.getUserInfoByUserName(userName);</span><br><span class="line">    <span class="keyword">if</span> (userInfoEntity == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnknownAccountException(<span class="string">"账号不存在"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (userInfoEntity.getStatus() == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> LockedAccountException(<span class="string">"账号被锁定"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(userInfoEntity, userInfoEntity.getPassword(),</span><br><span class="line">            ByteSource.Util.bytes(userInfoEntity.getSalt()), <span class="keyword">super</span>.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote></blockquote><blockquote><blockquote><p>userService<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> UserInfoEntityMapper userMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RoleEntityMapper roleMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> OperatorEntityMapper operatorMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> MenuEntityMapper menuMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;shiro.admin&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String adminUser;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> UserInfoEntity <span class="title">getAllUserInfoByUserName</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">    UserInfoEntity userInfoEntity = userMapper.selectAllUserInfoByUserName(userName);</span><br><span class="line">    <span class="keyword">if</span> (userName.equals(adminUser))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//超级管理员账号获取所有角色和权限</span></span><br><span class="line">        List&lt;RoleEntity&gt; roleEntities = roleMapper.selectAllRoles();</span><br><span class="line">        List&lt;MenuEntity&gt; menuEntities = menuMapper.selectAllMenu();</span><br><span class="line">        List&lt;OperatorEntity&gt; operatorEntities = operatorMapper.selectAllOperator();</span><br><span class="line">        roleEntities.get(<span class="number">0</span>).setMenus(menuEntities);</span><br><span class="line">        roleEntities.get(<span class="number">0</span>).setOperators(operatorEntities);</span><br><span class="line">        userInfoEntity.setRoles(roleEntities);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> userInfoEntity;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> UserInfoEntity <span class="title">getUserInfoByUserName</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userMapper.selectUserInfoByUserName(userName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote></blockquote><h3 id="ShiroConfig"><a href="#ShiroConfig" class="headerlink" title="ShiroConfig"></a>ShiroConfig</h3><blockquote><blockquote><p>shiro核心配置类</p></blockquote></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * create by: liumeng</span></span><br><span class="line"><span class="comment">    * description: 开启thymeleaf shiro标签 支持</span></span><br><span class="line"><span class="comment">    * create time: 2019/8/29 15:19</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ：</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> : at.pollux.thymeleaf.shiro.dialect.ShiroDialect</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> ShiroDialect <span class="title">shiroDialect</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> ShiroDialect();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * create by: liumeng</span></span><br><span class="line"><span class="comment">    * description: 密码匹配器</span></span><br><span class="line"><span class="comment">    * create time: 2019/8/29 14:14</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ：</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> : org.apache.shiro.authc.credential.HashedCredentialsMatcher</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> HashedCredentialsMatcher <span class="title">hashedCredentialsMatcher</span><span class="params">()</span></span>&#123;</span><br><span class="line">       HashedCredentialsMatcher hashedCredentialsMatcher = <span class="keyword">new</span> HashedCredentialsMatcher();</span><br><span class="line">       hashedCredentialsMatcher.setHashAlgorithmName(<span class="string">"md5"</span>);</span><br><span class="line">       <span class="comment">//散列次数</span></span><br><span class="line">       hashedCredentialsMatcher.setHashIterations(<span class="number">2</span>);</span><br><span class="line">       <span class="keyword">return</span> hashedCredentialsMatcher;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * create by: liumeng</span></span><br><span class="line"><span class="comment">    * description: 自定义Shiro域</span></span><br><span class="line"><span class="comment">    * create time: 2019/8/29 15:16</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ：</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> : com.shiro.howard.lm.config.MyShiroRealm</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> MyShiroRealm <span class="title">myShiroRealm</span><span class="params">()</span></span>&#123;</span><br><span class="line">       MyShiroRealm myShiroRealm = <span class="keyword">new</span> MyShiroRealm();</span><br><span class="line">       <span class="comment">//注入自定义密码匹配器</span></span><br><span class="line">       myShiroRealm.setCredentialsMatcher(hashedCredentialsMatcher());</span><br><span class="line">       <span class="keyword">return</span> myShiroRealm;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * create by: liumeng</span></span><br><span class="line"><span class="comment">    * description: 注入securityManager</span></span><br><span class="line"><span class="comment">    * create time: 2019/8/29 15:18</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ：</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> : org.apache.shiro.mgt.SecurityManager</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> SecurityManager <span class="title">securityManager</span><span class="params">()</span></span>&#123;</span><br><span class="line">       DefaultWebSecurityManager securityManager = <span class="keyword">new</span> DefaultWebSecurityManager();</span><br><span class="line">       securityManager.setRealm(myShiroRealm());</span><br><span class="line">       <span class="keyword">return</span> securityManager;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * create by: liumeng</span></span><br><span class="line"><span class="comment">    * description: 配置Shiro过滤规则</span></span><br><span class="line"><span class="comment">    * create time: 2019/8/29 15:22</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ： securityManager</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> : org.apache.shiro.spring.web.ShiroFilterFactoryBean</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">shiroFilterFactoryBean</span><span class="params">(SecurityManager securityManager)</span></span>&#123;</span><br><span class="line">       ShiroFilterFactoryBean shiroFilterFactoryBean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line">       shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line">       <span class="comment">//配置拦截器</span></span><br><span class="line">       Map&lt;String,String&gt; filterMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">       filterMap.put(<span class="string">"/favicon.ico"</span>, <span class="string">"anon"</span>);</span><br><span class="line">       filterMap.put(<span class="string">"/css/**"</span>, <span class="string">"anon"</span>);</span><br><span class="line">       filterMap.put(<span class="string">"/fonts/**"</span>, <span class="string">"anon"</span>);</span><br><span class="line">       filterMap.put(<span class="string">"/images/**"</span>, <span class="string">"anon"</span>);</span><br><span class="line">       filterMap.put(<span class="string">"/js/**"</span>, <span class="string">"anon"</span>);</span><br><span class="line">       filterMap.put(<span class="string">"/lib/**"</span>, <span class="string">"anon"</span>);</span><br><span class="line">       filterMap.put(<span class="string">"/login"</span>, <span class="string">"anon"</span>);</span><br><span class="line">       filterMap.put(<span class="string">"/register"</span>, <span class="string">"anon"</span>);</span><br><span class="line">       filterMap.put(<span class="string">"/403"</span>, <span class="string">"anon"</span>);</span><br><span class="line">       filterMap.put(<span class="string">"/404"</span>, <span class="string">"anon"</span>);</span><br><span class="line">       filterMap.put(<span class="string">"/500"</span>, <span class="string">"anon"</span>);</span><br><span class="line">       filterMap.put(<span class="string">"/error"</span>, <span class="string">"anon"</span>);</span><br><span class="line">       filterMap.put(<span class="string">"/login"</span>,<span class="string">"anon"</span>);</span><br><span class="line">       filterMap.put(<span class="string">"/logout"</span>,<span class="string">"logout"</span>);</span><br><span class="line">       filterMap.put(<span class="string">"/**"</span>,<span class="string">"authc"</span>);</span><br><span class="line">       shiroFilterFactoryBean.setLoginUrl(<span class="string">"/login"</span>);</span><br><span class="line">       shiroFilterFactoryBean.setSuccessUrl(<span class="string">"/index"</span>);</span><br><span class="line">       shiroFilterFactoryBean.setUnauthorizedUrl(<span class="string">"/403"</span>);</span><br><span class="line">       shiroFilterFactoryBean.setFilterChainDefinitionMap(filterMap);</span><br><span class="line">       <span class="keyword">return</span> shiroFilterFactoryBean;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * create by: liumeng</span></span><br><span class="line"><span class="comment">    * description: 开启AOP注解</span></span><br><span class="line"><span class="comment">    * create time: 2019/8/29 15:24</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ： securityManager</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> : org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> AuthorizationAttributeSourceAdvisor <span class="title">authorizationAttributeSourceAdvisor</span><span class="params">(SecurityManager securityManager)</span></span>&#123;</span><br><span class="line">       AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = <span class="keyword">new</span> AuthorizationAttributeSourceAdvisor();</span><br><span class="line">       authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);</span><br><span class="line">       <span class="keyword">return</span> authorizationAttributeSourceAdvisor;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * create by: liumeng</span></span><br><span class="line"><span class="comment">    * description: 扫描上下文，寻找所有的Advistor(通知器）</span></span><br><span class="line"><span class="comment">    *              将这些Advisor应用到所有符合切入点的Bean中。</span></span><br><span class="line"><span class="comment">    * create time: 2019/8/29 15:25</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ： </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> : org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> DefaultAdvisorAutoProxyCreator <span class="title">defaultAdvisorAutoProxyCreator</span><span class="params">()</span></span>&#123;</span><br><span class="line">       DefaultAdvisorAutoProxyCreator defaultAdvisorAutoProxyCreator=<span class="keyword">new</span> DefaultAdvisorAutoProxyCreator();</span><br><span class="line">       defaultAdvisorAutoProxyCreator.setProxyTargetClass(<span class="keyword">true</span>);</span><br><span class="line">       <span class="keyword">return</span> defaultAdvisorAutoProxyCreator;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
          <category> Shiro </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shiro </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>库存同步</title>
      <link href="/2019/02/25/%E5%BA%93%E5%AD%98%E5%90%8C%E6%AD%A5/"/>
      <url>/2019/02/25/%E5%BA%93%E5%AD%98%E5%90%8C%E6%AD%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="库存同步"><a href="#库存同步" class="headerlink" title="库存同步"></a>库存同步</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>公司自研<strong>ORP(Order Resource manage Plateform订单资源管理平台)</strong>上线后，公司对库存的管理做了相应的调整,工厂使用用友U8系统进行生产和成品库存管理，销售公司订单部进行销售发货是使用公司自研的订单ERP系统完成货运匹配、订单处理、打包发货等操作.为了实现两套系统中的库存同步，在各自系统中建立了同样的仓库，并靠人工每天将产生的订单进行导入或录入达到库存同步的目的,这种库存同步的方式耗费人工的且库存时效性低，因此需进行系统之间的数据集成，达到数据时效性和降低人工成本的目的<br><a id="more"></a></p><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>在保证系统稳定的前提下实现库存的自动同步,提高同步的时效性</p><h2 id="技术选取"><a href="#技术选取" class="headerlink" title="技术选取"></a>技术选取</h2><p>1.U8到中间件的数据同步,采用数据库触发器的方式写入中间件数据库.当有新数据插入的时候会触发触发器,开始往中间件数据库写入数据.<br>2.为了保证数据传输的可靠性,中间件与ORP的通信采用消息队列方式实现,并开启ACK验证,消息持久化.</p><h2 id="系统时序图"><a href="#系统时序图" class="headerlink" title="系统时序图"></a>系统时序图</h2><h3 id="U8同步库存到ERP序列图"><a href="#U8同步库存到ERP序列图" class="headerlink" title="U8同步库存到ERP序列图"></a>U8同步库存到ERP序列图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">participant U8</span><br><span class="line">participant 中间件</span><br><span class="line">participant ERP</span><br><span class="line">U8-&gt;&gt;中间件:新的出入库记录(排除ERP同步订单)</span><br><span class="line">中间件-&gt;&gt;ERP:发送新的库存变更记录</span><br><span class="line">ERP-&gt;&gt;中间件:返回同步结果</span><br><span class="line">note left of 中间件:更新中间件数据库状态</span><br></pre></td></tr></table></figure><h3 id="ERP出入库记录同步到U8"><a href="#ERP出入库记录同步到U8" class="headerlink" title="ERP出入库记录同步到U8"></a>ERP出入库记录同步到U8</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">participant U8</span><br><span class="line">participant 中间件</span><br><span class="line">participant ERP</span><br><span class="line">ERP-&gt;&gt;中间件:出入库记录及详情</span><br><span class="line">中间件-&gt;&gt;U8:调用存储过程在U8数据库生成发货单和出库单</span><br><span class="line">U8-&gt;&gt;中间件:返回单据号和其他信息回写到中间件</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>]]></content>
      
      
      <categories>
          
          <category> U8库存同步 </category>
          
          <category> 系统设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> U8库存同步 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>上线流程</title>
      <link href="/2019/02/25/%E4%B8%8A%E7%BA%BF%E6%B5%81%E7%A8%8B/"/>
      <url>/2019/02/25/%E4%B8%8A%E7%BA%BF%E6%B5%81%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p><strong>由于本项目涉及到两个系统的对接,特给出上线流程</strong><br><a id="more"></a><br>1.清空中间库数据,手动添加公司和仓库code映射表数据</p><p>2.U8库存同步到中间件,考虑到erp同步逻辑的耗时太长,首次发送需要手动删除队列中的数据</p><p>3.核对库存</p><p>4.告知业务部门项目上线时间,上线前的数据需要手动做单</p><p>5.上线后的从erp到u8的数据需要业务部门确认:是否对现有u8业务逻辑有影响,以及核对同步单据的数据纬度是否与手动做单的数据纬度一致</p><p>6.上线后的数据确认工作:上线一个月内,随机校验库存,保证同步系统的稳定性</p><p>7.上线后完善程序心跳 机制,确保系统线程下线能随时监测到并重启</p>]]></content>
      
      
      <categories>
          
          <category> U8库存同步 </category>
          
          <category> 上线 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> U8库存同步 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2019/02/21/hello-world/"/>
      <url>/2019/02/21/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.<br><a id="more"></a></p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
